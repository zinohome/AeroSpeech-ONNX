# 项目概述

## 1. 项目简介

本项目是一个基于 **sherpa-onnx** 的语音识别（STT）和文本转语音（TTS）服务器系统，使用 Go 语言开发。系统采用微服务架构，STT 和 TTS 服务分别独立部署，通过 WebSocket 和 RESTful API 提供服务。

## 2. 项目目标

### 2.1 核心目标
- 提供高性能、低延迟的语音识别服务
- 提供稳定可靠的文本转语音服务
- 支持实时流式处理和批量处理
- 支持多语言识别和合成
- 提供完善的监控和管理功能

### 2.2 技术目标
- **CPU模式**: 支持CPU环境下的STT和TTS服务
  - STT 延迟控制在 200-400ms（1秒音频）
  - TTS 生成时间控制在 2-5 秒（5秒音频）
- **GPU模式**: 支持GPU加速（可选）
  - STT 延迟控制在 50-100ms（1秒音频）
  - TTS 生成时间控制在 0.5-1 秒（5秒音频）
- 支持高并发（100+ 并发连接）
- 代码测试覆盖率 ≥ 80%
- **Provider可配置**: 支持CPU/GPU动态切换

## 3. 技术栈

### 3.1 后端技术
- **语言**: Go 1.21+
- **语音引擎**: sherpa-onnx (C API)
- **Go 绑定**: github.com/k2-fsa/sherpa-onnx-go
- **执行后端**: ONNX Runtime (支持CPU/CUDA)
- **GPU支持**: NVIDIA CUDA (可选)
- **Web 框架**: Gin
- **WebSocket**: Gorilla WebSocket
- **配置管理**: Viper
- **日志**: Logrus / Zap

### 3.2 前端技术
- **HTML5**: 原生 HTML/CSS/JavaScript
- **WebSocket API**: 实时通信
- **Web Audio API**: 音频处理
- **图表库**: Chart.js (监控面板)

### 3.3 部署技术
- **容器化**: Docker
- **编排**: Docker Compose
- **GPU容器**: NVIDIA Container Toolkit (可选)
- **监控**: 内置监控 API

## 4. 功能特性

### 4.1 STT 服务功能
- ✅ 实时流式语音识别（WebSocket）
- ✅ 音频文件上传识别（REST API）
- ✅ 多语言支持（中文、英文、日文、韩文等）
- ✅ VAD（语音活动检测）自动分段
- ✅ 识别结果实时返回
- ✅ 批量文件处理

### 4.2 TTS 服务功能
- ✅ 文本转语音合成
- ✅ 多说话人支持
- ✅ 语速、音调调节
- ✅ 实时音频流输出（WebSocket）
- ✅ 音频文件下载
- ✅ 批量文本合成

### 4.3 管理功能
- ✅ Web 测试界面
- ✅ 实时监控面板
- ✅ 健康检查接口
- ✅ 统计信息接口
- ✅ 会话管理
- ✅ 性能指标监控

## 5. 项目结构

```
AeroSpeech-ONNX/
├── cmd/                    # 服务入口
│   ├── stt-server/         # STT服务入口
│   └── tts-server/         # TTS服务入口
├── internal/               # 内部代码
│   ├── common/             # 共享代码
│   │   ├── config/         # 配置管理
│   │   ├── handlers/       # HTTP处理器
│   │   ├── logger/         # 日志
│   │   ├── router/         # 路由
│   │   ├── session/        # 会话管理
│   │   └── ws/             # WebSocket处理
│   ├── asr/                # ASR模块
│   │   ├── manager.go
│   │   ├── provider.go
│   │   └── pool.go
│   └── tts/                # TTS模块
│       ├── manager.go
│       ├── provider.go
│       └── pool.go
├── pkg/                    # 可复用包
│   └── utils/              # 工具函数
├── web/                    # Web前端
│   ├── static/             # 静态资源
│   └── templates/          # HTML模板
├── configs/                # 配置文件
│   ├── stt-config.json
│   └── tts-config.json
├── docs/                   # 文档
├── scripts/                # 脚本
├── test/                   # 测试文件
│   ├── unit/               # 单元测试
│   ├── integration/        # 集成测试
│   └── performance/         # 性能测试
├── Dockerfile.stt          # STT服务Dockerfile
├── Dockerfile.tts          # TTS服务Dockerfile
├── docker-compose.yml      # Docker编排
├── go.mod
└── README.md
```

## 6. 部署架构

### 6.1 服务分离
- **STT 服务**: 独立部署，端口 8080
- **TTS 服务**: 独立部署，端口 8081
- **共享代码**: 通过 Go 模块复用

### 6.2 部署方式
- **开发环境**: 本地运行
- **生产环境**: Docker 容器化部署
- **扩展性**: 支持水平扩展（多实例）

## 7. 性能指标

### 7.1 STT 性能目标

#### CPU模式
- **延迟**: 200-400ms（1秒音频）
- **吞吐量**: 100+ 并发识别
- **准确率**: ≥ 95%（中文）
- **CPU 使用**: 单核 50-80%

#### GPU模式
- **延迟**: 50-100ms（1秒音频）
- **吞吐量**: 200+ 并发识别
- **准确率**: ≥ 95%（中文）
- **GPU 使用**: 显存 2-4GB
- **性能提升**: 3-5倍

### 7.2 TTS 性能目标

#### CPU模式
- **生成时间**: 2-5秒（5秒音频）
- **并发数**: 10-20 并发合成
- **CPU 使用**: 单核 60-90%
- **内存**: ≤ 2GB（含模型）

#### GPU模式
- **生成时间**: 0.5-1秒（5秒音频）
- **并发数**: 30-50 并发合成
- **GPU 使用**: 显存 2-4GB
- **性能提升**: 3-5倍

## 8. 项目里程碑

### Phase 1: 基础架构（第1-2周）
- 项目结构搭建
- 共享代码模块开发
- 配置管理实现

### Phase 2: STT 服务（第3-4周）
- ASR 模块开发
- WebSocket 实现
- Web 测试界面

### Phase 3: TTS 服务（第5-6周）
- TTS 模块开发
- TTS API 实现
- TTS 测试界面

### Phase 4: 监控和优化（第7-8周）
- 监控面板开发
- 性能优化
- 测试和文档完善

## 9. 参考项目

- [sherpa-onnx](https://github.com/k2-fsa/sherpa-onnx) - 核心语音引擎
- [achatbot-go](https://github.com/weedge/achatbot-go) - 多模态聊天机器人参考
- [asr_server](https://github.com/bbeyondllove/asr_server) - ASR 服务器参考

## 10. 许可证

Apache-2.0 License

